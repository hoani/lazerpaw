<html>

<head>
    <title>LazerPaw</title>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"> </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

    <script type=text/javascript>
        $(function() { $("#specialBtn").click(function (event) { 
            basicConfetti()
            $.getJSON('/button?special', { }, function(data) { }); 
            return false; 
        }); }); 
        $(function() { $("#videofeed").click(function (event) { 
            e = document.getElementById("videofeed");
            mouseconfetti((e.width-event.offsetX)/e.width,  (e.height - event.offsetY)/e.height);
         }); }); 
    </script>
    <link rel="stylesheet" href='../static/style.css' />
</head>

<body onload="basicConfetti()">
    <h1>Special LazerPaw Secret!</h1>
    <div class="container-fluid text-center">
        <div class="row justify-content-md-center my-2">
            <div class="col-1">

            </div>
            <div class="col-3">
                <button type="button" id="specialBtn" class="btn btn-warning full-width">PRESS ME</button>
            </div>
            <div class="col-1 justify-self-end">
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-md-auto">
                <div class="video-container">
                    <img id="videofeed" src="{{ url_for('video_feed') }}"
                        style="pointer-events: auto; transform: rotate(180deg);">
                    <div class="state">
                        <span id="state_data">UNKNOWN</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <h4>
                <span id="time_data">???</span>
            </h4>
        </div>
    </div>
    <hr>

    <script>
        // Data feed handling.
        var time_data = document.getElementById('time_data');
        var state_data = document.getElementById('state_data');
        var remaining_data = document.getElementById('remaining_data');

        var xhr = new XMLHttpRequest();
        xhr.open('GET', "{{ url_for('data_feed') }}");


        xhr.onreadystatechange = function () {
            var messages = xhr.responseText.split('\n');
            last = messages.length - 2;
            data = JSON.parse(messages[last]);
            if (data["time"] != false) {
                time_data.textContent = data["time"];
            }
            if (data["state"] != false) {
                state_data.textContent = data["state"].toUpperCase();
            }
            if (typeof data["remaining"] == 'number') {
                remaining_data.textContent = data["remaining"].toFixed(2);
            } else {
                remaining_data.textContent = "";
            }
        }

        xhr.send();

        // Confetti nonsense.
        function basicConfetti() {
            confetti({
                particleCount: 1000,
                spread: 500,
                origin: { y: 0.7 }
            });
        }
        function mouseconfetti(x, y) {
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { x: x, y: y }
            });
        }
    </script>
</body>

</html>